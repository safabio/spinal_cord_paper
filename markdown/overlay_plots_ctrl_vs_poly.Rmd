---
title: "Ctrl Poly candidates dotplots"
author: "Fabio Sacher"
date: "24.10.2023"
data:
output:
  html_document:
    df_print: paged
    toc: TRUE
    toc_float: TRUE
  html_notebook:
    fig_height: 7
    fig_width: 8
editor_options:
  chunk_output_type: inline
---


```{r libraries}
library(Seurat)
library(stringr)
library(tibble)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(patchwork)
library(modplots)
```

# Data Sets

```{r data-sets}
my.ctrl <- readRDS("~/spinal_cord_paper/data/Gg_ctrl_int_seurat_250723.rds")
my.poly <- readRDS("~/spinal_cord_paper/data/Gg_poly_int_seurat_250723.rds")
```

# Ctrl cl 16 markers

The markers are the potential marker genes for ctrl cluster 16 and poly cluster 14. The candidates are genes that are differentially expressed between them.

```{r markers_16}
gnames <- modplots::gnames

candidates <- c("ST18","EPB41","ASCL1","NOTCH1","RELN")
markers_16 <- c("RGS3", "GADD45A", "AFAP1", "GADD45G")

```

## Overlay plots

The plots show co-expression of markers and candidates and act as a "*in-silico* double FISH".

```{r overlay-plots_cl_16}
cl_16_ctrl <- list(list(),list(),list(),list())
cl_16_poly <- list(list(),list(),list(),list())


for (i in seq(markers_16)) {
  for (j in seq(candidates)) {
    # Plot as list
    tmp <- FeaturePlot(
      my.ctrl,
      features = c(gnames$Gene.stable.ID[gnames$Gene.name %in% markers_16[i]],
                   gnames$Gene.stable.ID[gnames$Gene.name %in% candidates[j]]),
      blend = TRUE,
      reduction = "tsne",
      order = TRUE, 
      combine = FALSE
    )
    # create patchwork
    p <- (tmp[[1]] + tmp[[2]])/
      (tmp[[3]] + tmp[[4]]) + 
      plot_annotation(paste0(
        "Overlay of ",
        markers_16[i],
        " and ",
        candidates[j],
        " expression (ctrl)"
      )) +
      plot_layout(guides = 'collect') & theme_gray()
    
    # store patchwork as list
    cl_16_ctrl[[i]][j] <- list(p)
    
    # Plot as list
    tmp <- FeaturePlot(
      my.poly,
      features = c(gnames$Gene.stable.ID[gnames$Gene.name %in% markers_16[i]],
                   gnames$Gene.stable.ID[gnames$Gene.name %in% candidates[j]]),
      blend = TRUE,
      reduction = "tsne",
      order = TRUE, 
      combine = FALSE
    )
    # create patchwork
    p <- (tmp[[1]] + tmp[[2]])/
      (tmp[[3]] + tmp[[4]]) + 
      plot_annotation(paste0(
        "Overlay of ",
        markers_16[i],
        " and ",
        candidates[j],
        " expression (poly)"
      )) +
      plot_layout(guides = 'collect') & theme_gray()
    
    # store patchwork as list
    cl_16_poly[[i]][j] <- list(p)
    
    }
  names(cl_16_ctrl[[i]]) <- candidates
  names(cl_16_poly[[i]]) <- candidates
  
}

names(cl_16_ctrl) <- markers_16
names(cl_16_poly) <- markers_16
```

## example plot

```{r}
cl_16_ctrl[[1]][[1]]
```


```{r export-pdf-16}

pdf("~/spinal_cord_paper/figures/ctrl_overlay_ctrl_clust_16.pdf", width = 9, height = 7)
DimPlot(my.ctrl, reduction = "tsne", label = TRUE) + theme_void() + ggtitle("Clusters of interest: cl_16")
for (i in seq(markers_16)) {
  for (j in seq(candidates)) {
    grid.arrange(patchworkGrob(cl_16_ctrl[[i]][[j]]))
  }
}
dev.off()

pdf("~/spinal_cord_paper/figures/poly_overlay_ctrl_clust_16.pdf", width = 9, height = 7)
DimPlot(my.poly, reduction = "tsne", label = TRUE) + theme_void() + ggtitle("Clusters of interest: cl_14")
  for (i in seq(markers_16)) {
    for (j in seq(candidates)) {
      grid.arrange(patchworkGrob(cl_16_poly[[i]][[j]]))
    }
  }
dev.off()
```

# Ctrl cl 11 markers

The markers are the potential marker genes for ctrl cluster 11 and poly cluster 15. The candidates are genes that are differentially expressed between them.

```{r markers_11}

candidates <- c("SPOCK1","RUNX1T1","TAC1", "RELN")
markers_11 <- c("LMX1B", "TLX3", "NRN1", "EPHA3")

```

```{r overlay-plots}

cl_11_ctrl <- list(list(),list(),list(),list())
cl_11_poly <- list(list(),list(),list(),list())


for (i in seq(markers_11)) {
  for (j in seq(candidates)) {
    # Plot as list
    tmp <- FeaturePlot(
      my.ctrl,
      features = c(gnames$Gene.stable.ID[gnames$Gene.name %in% markers_11[i]],
                   gnames$Gene.stable.ID[gnames$Gene.name %in% candidates[j]]),
      blend = TRUE,
      reduction = "tsne",
      order = TRUE, 
      combine = FALSE
    )
    # create patchwork
    p <- (tmp[[1]] + tmp[[2]])/
      (tmp[[3]] + tmp[[4]]) + 
      plot_annotation(paste0(
        "Overlay of ",
        markers_11[i],
        " and ",
        candidates[j],
        " expression (ctrl)"
      )) +
      plot_layout(guides = 'collect') & theme_gray()
    
    # store patchwork as list
    cl_11_ctrl[[i]][j] <- list(p)
    
    # Plot as list
    tmp <- FeaturePlot(
      my.poly,
      features = c(gnames$Gene.stable.ID[gnames$Gene.name %in% markers_11[i]],
                   gnames$Gene.stable.ID[gnames$Gene.name %in% candidates[j]]),
      blend = TRUE,
      reduction = "tsne",
      order = TRUE, 
      combine = FALSE
    )
    # create patchwork
    p <- (tmp[[1]] + tmp[[2]])/
      (tmp[[3]] + tmp[[4]]) + 
      plot_annotation(paste0(
        "Overlay of ",
        markers_11[i],
        " and ",
        candidates[j],
        " expression (poly)"
      )) +
      plot_layout(guides = 'collect') & theme_gray()
    
    # store patchwork as list
    cl_11_poly[[i]][j] <- list(p)
    
  }
  names(cl_11_ctrl[[i]]) <- candidates
  names(cl_11_poly[[i]]) <- candidates
  
}

names(cl_11_ctrl) <- markers_11
names(cl_11_poly) <- markers_11


```

## example plot

```{r}
cl_11_ctrl[[1]][[1]]
```

```{r export-pdf-11}

pdf("~/spinal_cord_paper/figures/ctrl_overlay_ctrl_clust_11.pdf", width = 9, height = 7)
DimPlot(my.ctrl, reduction = "tsne", label = TRUE) + theme_void() + ggtitle("Clusters of interest: cl_11")
for (i in seq(markers_11)) {
  for (j in seq(candidates)) {
    grid.arrange(patchworkGrob(cl_11_ctrl[[i]][[j]]))
  }
}
dev.off()

pdf("~/spinal_cord_paper/figures/poly_overlay_ctrl_clust_11.pdf", width = 9, height = 7)
DimPlot(my.poly, reduction = "tsne", label = TRUE) + theme_void() + ggtitle("Clusters of interest: cl_15")
for (i in seq(markers_11)) {
  for (j in seq(candidates)) {
    grid.arrange(patchworkGrob(cl_11_poly[[i]][[j]]))
  }
}
dev.off()

```

```{r Session-info}
# Date and time of Rendering
Sys.time()

sessionInfo()
```